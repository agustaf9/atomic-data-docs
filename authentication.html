<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Authentication - Atomic Data Docs</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Documentation for the Atomic Data standard.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="open-in.css">
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="atomic-data-overview.html"><strong aria-hidden="true">1.</strong> Atomic Data Overview</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="motivation.html"><strong aria-hidden="true">1.1.</strong> Motivation</a></li><li class="chapter-item expanded "><a href="roadmap.html"><strong aria-hidden="true">1.2.</strong> Strategy, history and roadmap</a></li><li class="chapter-item expanded "><a href="when-to-use.html"><strong aria-hidden="true">1.3.</strong> When (not) to use it</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Specification (core)</li><li class="chapter-item expanded "><a href="core/concepts.html"><strong aria-hidden="true">2.</strong> What is Atomic Data?</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="core/serialization.html"><strong aria-hidden="true">2.1.</strong> Serialization</a></li><li class="chapter-item expanded "><a href="core/json-ad.html"><strong aria-hidden="true">2.2.</strong> JSON-AD</a></li><li class="chapter-item expanded "><a href="core/querying.html"><strong aria-hidden="true">2.3.</strong> Querying</a></li><li class="chapter-item expanded "><a href="core/paths.html"><strong aria-hidden="true">2.4.</strong> Paths</a></li></ol></li><li class="chapter-item expanded "><a href="schema/intro.html"><strong aria-hidden="true">3.</strong> Schema</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="schema/classes.html"><strong aria-hidden="true">3.1.</strong> Classes</a></li><li class="chapter-item expanded "><a href="schema/datatypes.html"><strong aria-hidden="true">3.2.</strong> Datatypes</a></li><li class="chapter-item expanded "><a href="schema/translations.html"><strong aria-hidden="true">3.3.</strong> Translations</a></li><li class="chapter-item expanded "><a href="schema/faq.html"><strong aria-hidden="true">3.4.</strong> FAQ</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Specification (extended)</li><li class="chapter-item expanded "><a href="extended.html"><strong aria-hidden="true">4.</strong> Atomic Data Extended</a></li><li class="chapter-item expanded "><a href="agents.html"><strong aria-hidden="true">5.</strong> Agents</a></li><li class="chapter-item expanded "><a href="hierarchy.html"><strong aria-hidden="true">6.</strong> Hierarchy and authorization</a></li><li class="chapter-item expanded "><a href="authentication.html" class="active"><strong aria-hidden="true">7.</strong> Authentication</a></li><li class="chapter-item expanded "><a href="invitations.html"><strong aria-hidden="true">8.</strong> Invitations and sharing</a></li><li class="chapter-item expanded "><a href="commits/intro.html"><strong aria-hidden="true">9.</strong> Commits (writing data)</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="commits/concepts.html"><strong aria-hidden="true">9.1.</strong> Concepts</a></li><li class="chapter-item expanded "><a href="commits/compare.html"><strong aria-hidden="true">9.2.</strong> Compared to</a></li></ol></li><li class="chapter-item expanded "><a href="websockets.html"><strong aria-hidden="true">10.</strong> WebSockets</a></li><li class="chapter-item expanded "><a href="endpoints.html"><strong aria-hidden="true">11.</strong> Endpoints</a></li><li class="chapter-item expanded "><a href="schema/collections.html"><strong aria-hidden="true">12.</strong> Collections, filtering, sorting</a></li><li class="chapter-item expanded "><a href="files.html"><strong aria-hidden="true">13.</strong> Uploading and downloading files</a></li><li class="chapter-item expanded affix "><li class="part-title">Create Atomic Data</li><li class="chapter-item expanded "><a href="atomizing.html"><strong aria-hidden="true">14.</strong> Atomizing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="atomic-server.html"><strong aria-hidden="true">14.1.</strong> Using Atomic-Server</a></li><li class="chapter-item expanded "><a href="create-json-ad.html"><strong aria-hidden="true">14.2.</strong> Creating a JSON-AD file</a></li><li class="chapter-item expanded "><a href="interoperability/upgrade.html"><strong aria-hidden="true">14.3.</strong> Upgrade your existing project</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Use Atomic Data</li><li class="chapter-item expanded "><a href="interoperability/intro.html"><strong aria-hidden="true">15.</strong> Interoperability and comparisons</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="interoperability/rdf.html"><strong aria-hidden="true">15.1.</strong> RDF</a></li><li class="chapter-item expanded "><a href="interoperability/solid.html"><strong aria-hidden="true">15.2.</strong> Solid</a></li><li class="chapter-item expanded "><a href="interoperability/json.html"><strong aria-hidden="true">15.3.</strong> JSON</a></li><li class="chapter-item expanded "><a href="interoperability/ipfs.html"><strong aria-hidden="true">15.4.</strong> IPFS</a></li><li class="chapter-item expanded "><a href="interoperability/sql.html"><strong aria-hidden="true">15.5.</strong> SQL</a></li><li class="chapter-item expanded "><a href="interoperability/graph-database.html"><strong aria-hidden="true">15.6.</strong> Graph Databases</a></li></ol></li><li class="chapter-item expanded "><a href="usecases/intro.html"><strong aria-hidden="true">16.</strong> Potential use cases</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="usecases/headless-cms.html"><strong aria-hidden="true">16.1.</strong> As a Headless CMS</a></li><li class="chapter-item expanded "><a href="usecases/react.html"><strong aria-hidden="true">16.2.</strong> In a React project</a></li><li class="chapter-item expanded "><a href="usecases/personal-data-store.html"><strong aria-hidden="true">16.3.</strong> Personal Data Store</a></li><li class="chapter-item expanded "><a href="usecases/e-commerce.html"><strong aria-hidden="true">16.4.</strong> E-commerce & marketplaces</a></li><li class="chapter-item expanded "><a href="usecases/surveys.html"><strong aria-hidden="true">16.5.</strong> Surveys</a></li><li class="chapter-item expanded "><a href="usecases/verifiable-credentials.html"><strong aria-hidden="true">16.6.</strong> Verifiable Credentials</a></li><li class="chapter-item expanded "><a href="usecases/food-labels.html"><strong aria-hidden="true">16.7.</strong> Food labels</a></li></ol></li><li class="chapter-item expanded "><a href="tooling.html"><strong aria-hidden="true">17.</strong> Software and libraries</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><a href="acknowledgements.html">Acknowledgements</a></li><li class="chapter-item expanded affix "><a href="newsletter.html">Newsletter</a></li><li class="chapter-item expanded affix "><a href="get-involved.html">Get involved</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Atomic Data Docs</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/atomicdata-dev/atomic-data-docs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="authentication-in-atomic-data"><a class="header" href="#authentication-in-atomic-data">Authentication in Atomic Data</a></h1>
<p>Authentication means knowing <em>who</em> is doing something, either getting access or creating some new data.
When an Agent wants to <em>edit</em> a resource, they have to send a signed <a href="commits/intro.html">Commit</a>, and the signatures are checked in order to authorize a Commit.</p>
<p>But how do we deal with <em>reading</em> data, how do we know who is trying to get access?
That's what this page will explain.
The short answer is: <strong>By signing the HTTP request</strong>.</p>
<h2 id="design-goals"><a class="header" href="#design-goals">Design goals</a></h2>
<ul>
<li><strong>Secure</strong>: Because, what's the point of authentication if it's not?</li>
<li><strong>Easy to use</strong>: Setting up an identity should not require <em>any</em> effort, and proving identity should be minimal effort.</li>
<li><strong>Anonimity allowed</strong>: Users should be able to have multiple identities, some of which are fully anonymous.</li>
<li><strong>Self-sovereign</strong>: No dependency on servers that user's don't control. Or at least, minimise this.</li>
<li><strong>Dummy-proof</strong>: We need a mechanism for dealing with forgetting passwords / client devices losing data.</li>
<li><strong>Compatible with Commits</strong>: Atomic Commits require clients to sign things. Ideally, this functionality / strategy would also fit with the new model.</li>
<li><strong>Fast</strong>: Of course, authentication will always slow things down. But let's keep that to a minimum.</li>
</ul>
<p>Authentication is done by signing individual (HTTP) requests with the Agent's private key.</p>
<h2 id="http-headers"><a class="header" href="#http-headers">HTTP Headers</a></h2>
<p>All of the following headers are required, if you need authentication.</p>
<ul>
<li><code>x-atomic-public-key</code>: The base64 public key (Ed25519) of the Agent sending the request</li>
<li><code>x-atomic-signature</code>: A base64 signature of the following string: <code>{subject} {timestamp}</code></li>
<li><code>x-atomic-timestamp</code>: The current time (when sending the request) as milliseconds since unix epoch</li>
<li><code>x-atomic-agent</code>: The subject URL of the Agent sending the request.</li>
</ul>
<h2 id="sending-a-request"><a class="header" href="#sending-a-request">Sending a request</a></h2>
<p>Here's an example (js) client side implementation with comments:</p>
<pre><code class="language-ts">// The Private Key of the agent is used for signing
// https://atomicdata.dev/properties/privateKey
const privateKey = &quot;someBase64Key&quot;;
const timestamp = Math.round(new Date().getTime());;
// This is what you will need to sign.
// The timestmap is to limit the harm of a man-in-the-middle attack.
// The `subject` is the full HTTP url that is to be fetched.
const message = `${subject} ${timestamp}`;
// Sign using Ed25519, see example implementation here: https://github.com/atomicdata-dev/atomic-data-browser/blob/30b2f8af59d25084de966301cb6bd1ed90c0eb78/lib/src/commit.ts#L176
const signed = await signToBase64(message, privateKey);
// Set all of these headers
const headers = new Headers;
headers.set('x-atomic-public-key', await agent.getPublicKey());
headers.set('x-atomic-signature', signed);
headers.set('x-atomic-timestamp', timestamp.toString());
headers.set('x-atomic-agent', agent?.subject);
const response = await fetch(subject, {headers});
</code></pre>
<h2 id="handling-a-request"><a class="header" href="#handling-a-request">Handling a request</a></h2>
<ul>
<li>If none of the <code>x-atomic</code> HTTP headers are present, the server assigns the <a href="https://atomicdata.dev/agents/publicAgent">PublicAgent</a> to the request. This Agent represents any guest who is not signed in.</li>
<li>If some (but not all) of the <code>x-atomic</code> headers are present, the server will return with a <code>500</code>.</li>
<li>The server must check the timestamp (max 10 seconds difference).</li>
<li>The server must check whether the public key matches the one from the Agent.</li>
<li>The server must check if the signature is valid.</li>
<li>The server must check if the request resource can be shared</li>
</ul>
<h2 id="authentication-resources-used-in-websockets"><a class="header" href="#authentication-resources-used-in-websockets">Authentication Resources (used in <a href="websockets.html">websockets</a>)</a></h2>
<p>An <em>Authentication Resource</em> is a JSON-AD object containing all the information a Server needs to make sure a valid Agent requests a session at some point in time.
It's fields are very similar to the headers shown above.
The signature still is a base64 signature of the following string: <code>{requestedSubject} {timestamp}</code>.
In Websocket connections, we use the <code>wss</code> address as the <code>requestedSubject</code>.</p>
<pre><code class="language-json">{
  &quot;https://atomicdata.dev/properties/auth/agent&quot;: &quot;http://example.com/agents/N32zQnZHoj1LbTaWI5CkA4eT2AaJNBPhWcNriBgy6CE=&quot;,
  &quot;https://atomicdata.dev/properties/auth/requestedSubject&quot;: &quot;wss://example.com/ws&quot;,
  &quot;https://atomicdata.dev/properties/auth/publicKey&quot;: &quot;N32zQnZHoj1LbTaWI5CkA4eT2AaJNBPhWcNriBgy6CE=&quot;,
  &quot;https://atomicdata.dev/properties/auth/timestamp&quot;: 1661757470002,
  &quot;https://atomicdata.dev/properties/auth/signature&quot;: &quot;19Ce38zFu0E37kXWn8xGEAaeRyeP6EK0S2bt03s36gRrWxLiBbuyxX3LU9qg68pvZTzY3/P3Pgxr6VrOEvYAAQ==&quot;
}
</code></pre>
<p>The Authentication Resource is sent after the websocket is opened, like so: <code>AUTHENTICATE {authenticationResource}</code>.</p>
<h2 id="hierarchies-for-authorization"><a class="header" href="#hierarchies-for-authorization">Hierarchies for authorization</a></h2>
<p>Atomic Data uses <a href="hierarchy.html">Hierarchies</a> to describe who gets to access some resource, and who can edit it.</p>
<h2 id="limitations--considerations"><a class="header" href="#limitations--considerations">Limitations / considerations</a></h2>
<ul>
<li>Since we need the Private Key to sign Commits and requests, the client should have this available. This means the client software as well as the user should deal with key management, and that can be a security risk in some contexts (such as a web browser). <a href="https://github.com/ontola/atomic-data-docs/issues/49">See issue #49</a>.</li>
<li>When using the Agent's subject to authenticate somwehere, the authorizer must be able to check what the public key of the agent is. This means the agent must be publicly resolvable. This is one of the reasons we should work towards a server-independent identifier, probably as base64 string that contains the public key (and, optionally, also the https identifier). See <a href="https://github.com/ontola/atomic-data-docs/issues/59">issue #59 on DIDs</a>.</li>
<li>Signing every single request takes a bit of time. We picked a fast algorithm (Ed25519) to minimize this cost.</li>
<li>We'll probably introduce some form of token-based-authentication in the future. <a href="https://github.com/ontola/atomic-data-docs/issues/87">See #87</a></li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/atomicdata-dev/atomic-data-docs/edit/main/src/authentication.md">Edit this page on GitHub.</a></footer>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="hierarchy.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="invitations.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="hierarchy.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="invitations.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Google Analytics Tag -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXVM8YFPWJ"></script>
        <script type="text/javascript">
            var localAddrs = ["localhost", "127.0.0.1", ""];

            // make sure we don't activate google analytics if the developer is
            // inspecting the book locally...
            if (localAddrs.indexOf(document.location.hostname) === -1) {
                window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}
                gtag('js', new Date());
                gtag('config', 'G-XXVM8YFPWJ');
            }
        </script>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script src="https://cdn.jsdelivr.net/npm/@widgetbot/crate@3" async defer>
        new Crate({
            server: '723588174747533393',
            channel: '723588175351513152',
        })
        </script>

    </body>
</html>
